components:
  schemas:
    BaseObject:
      type: object
      properties:
        oddrn:
          type: string
          example: "//aws/glue/{account_id}/{database}/{tablename}"
        name:
          type: string
          example: 
        owner:
          type: string
          example: "//aws/iam/{account_id}/user/name"
        metadata:
          type: object
          additionalProperties: 
            type: string
      required:
        - oddrn
        - name
        - owner
                
    DataSet:
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            parentOddrn:
              type: string
            description:
              type: string
            updatedAt:
              type: string
              format: date-time
            subtype:
              type: string
              enum: 
                - DATASET_TABLE
                - DATASET_FILE
                - DATASET_FEATURE_GROUP
            fieldList:
              type: array
              items:
                $ref: '#/components/schemas/DataSetField'            
            dataSetList:
              type: array
              items:
                $ref: '#/components/schemas/DataSet'
          required:
            - description
            - subtype
            - fieldList

    DataSetFieldStat:
      type: object
      properties:
        name:
          type: string
        complexStats:
          $ref: '#/components/schemas/ComplexFieldStat'
        booleanStats:
          $ref: '#/components/schemas/BooleanFieldStat'
        integerStats:
          $ref: '#/components/schemas/IntegerFieldStat'
        numberStats:
          $ref: '#/components/schemas/NumberFieldStat'
        stringStats:
          $ref: '#/components/schemas/StringFieldStat'
        binaryStats:
          $ref: '#/components/schemas/BinaryFieldStat'
        dateTimeStats:
          $ref: '#/components/schemas/DateTimeFieldStat'
      required:
        - name
    
    BooleanFieldStat:
      type: object
      properties:
        trueCount:
          type: integer
          format: int64 
        falseCount:
          type: integer
          format: int64 
        nullsCount:
          type: integer
          format: int64 
      required:
        - trueCount
        - falseCount
        - nullsCount

    ComplexFieldStat:
      type: object
      properties:
        nullsCount:
          type: integer
          format: int64
        uniqueCount:
          type: integer
          format: int64
      required:
        - nullsCount
        - uniqueCount

    NumberFieldStat:
      type: object
      properties:
        lowValue:
          type: number
        highValue:
          type: number
        meanValue:
          type: number
        medianValue:
          type: number
        nullsCount:
          type: integer
          format: int64
        uniqueCount:
          type: integer
          format: int64
      required:
        - lowValue
        - highValue
        - nullsCount
        - uniqueCount

    StringFieldStat:
      type: object
      properties:
        maxLength:
          type: integer
        avgLength:
          type: number
        nullsCount:
          type: integer
          format: int64
        uniqueCount:
          type: integer
          format: int64
      required:
        - maxLength
        - avgLength
        - nullsCount
        - uniqueCount          
    
    BinaryFieldStat:
      type: object
      properties:
        maxLength:
          type: integer
        avgLength:
          type: number
        nullsCount:
          type: integer
          format: int64
        uniqueCount:
          type: integer
          format: int64
      required:
        - maxLength
        - avgLength
        - nullsCount
        - uniqueCount          

    IntegerFieldStat:
      type: object
      properties:
        lowValue:
          type: integer
          format: int64
        highValue:
          type: integer
          format: int64
        meanValue:
          type: integer
          format: int64
        medianValue:
          type: integer
          format: int64         
        nullsCount:
          type: integer
          format: int64
        uniqueCount:
          type: integer
          format: int64
      required:
        - lowValue
        - highValue
        - nullsCount
        - uniqueCount          

    DateTimeFieldStat:
      type: object
      properties:
        lowValue:
          type: string
          format: date-time
        highValue:
          type: string
          format: date-time
        meanValue:
          type: string
          format: date-time
        medianValue:
          type: string
          format: date-time
        nullsCount:
          type: integer
          format: int64
        uniqueCount:
          type: integer
          format: int64
      required:
        - lowValue
        - highValue
        - nullsCount
        - uniqueCount          

    DataSetStat:
      type: object
      properties:
        rowsCount: 
          type: integer
          format: int64 
        uniqueRows:
          type: integer
          format: int64
      required:
        - rowsCount
        - uniqueRows

    DataSetFieldSchema:
      type: object
      properties:
        type:
          type: string
          enum:
            - TYPE_STRING
            - TYPE_NUMBER
            - TYPE_INTEGER
            - TYPE_BOOLEAN
            - TYPE_DATETIME
            - TYPE_STRUCT
            - TYPE_BINARY
            - TYPE_LIST
            - TYPE_MAP
        logicalType:
          type: string
        isNullable:
          type: boolean
        key:
          $ref: '#/components/schemas/DataSetFieldType'
        value:
          $ref: '#/components/schemas/DataSetFieldType'
        fieldList:
          type: array
          items:
            $ref: '#/components/schemas/DataSetField'
      required:
        - type
        - isNullable

    DataSetField:
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            name:
              type: string
            type:
              $ref: '#/components/schemas/DataSetFieldType'
            defaultValue:
              type: string
            description:
              type: string
          required:
            - name
            - type

    DataSetFieldType:
      type: object
      properties:
        schema:
          $ref: '#/components/schemas/DataSetFieldSchema'
        stats:
          $ref: '#/components/schemas/DataSetFieldStat'
      required:
        - schema


    DataSetList:
      type: array
      items:
        $ref: '#/components/schemas/DataSet'

    DataTransformer:
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            description:
              type: string
            sourceCodeUrl:
              type: string
            sql:
              type: string                        
            inputs:
              type: array
              items:
                type: string            
            outputs:
              type: array
              items:
                type: string
            subtype:
              type: string
              enum: 
                - DATATRANSFORMER_JOB
                - DATATRANSFORMER_EXPERIMENT
                - DATATRANSFORMER_ML_MODEL_TRAINING
          required:
            - description
            - inputs
            - outputs
            - subtype
    
    DataTransformerList:
      type: array
      items:
        $ref: '#/components/schemas/DataTransformer'

    DataConsumer:
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            description:
              type: string
            inputs:
              type: array
              items: 
                type: string
            subtype:
              type: string
              enum: 
                - DATACONSUMER_DASHBOARD
                - DATACONSUMER_ML_MODEL               
          required:
            - description
            - subtype
    
    DataConsumerList:
      type: array
      items:
        $ref: '#/components/schemas/DataConsumer'
    
    DataInput:
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            description:
              type: string
          required:
            - description
    
    DataInputList:
      type: array
      items:
        $ref: '#/components/schemas/DataInput'
    
    DataQualityTest:
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            description:
              type: string
            datasetList:
              type: array
              items:
                type: string
            suiteUrl:
              type: string
            linkedUrlList:
                type: array
                items:
                  $ref: '#/components/schemas/LinkedUrl'
          required:
            - description
            - datasetList

    DataQualityTestList:
      type: array
      items:
        $ref: '#/components/schemas/DataQualityTest'

    LinkedUrl:
      type: object
      properties:
        name: 
          type: string
        url:
          type: string
      required:
        - name
        - url

    DataTransformerRun:
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            transformerOddrn:
              type: string
            startTime:
              type: string
              format: date-time
            endTime:        
              type: string
              format: date-time
            statusReason:
              type: string
            status:
              type: string
              enum:
                - SUCCESS
                - FAIL
                - ABORTED
                - OTHER
          required:
            - transformerOddrn
            - startTime
            - endTime
            - status

  
    DataTransformerRunList:
      type: array
      items:
        $ref: '#/components/schemas/DataTransformerRun'
  
    DataQualityTestRun:  
      allOf:
        - $ref: '#/components/schemas/BaseObject'
        - type: object
          properties:
            dataQualityTestOddrn:
              type: string
            startTime:
              type: string
              format: date-time
            endTime:        
              type: string
              format: date-time
            statusReason:
              type: string
            status:
              type: string
              enum:
                - SUCCESS
                - FAIL
                - ABORTED
                - OTHER
          required:
            - dataQualityTestOddrn
            - startTime
            - endTime
            - status
    
    DataQualityTestRunList:
      type: array
      items:
        $ref: '#/components/schemas/DataQualityTestRun'

    SupportedEntityList:
      type: array
      items:
        $ref: '#/components/schemas/SupportedEntity'
        
    SupportedEntity:
      type: object
      properties:
        name: 
          type: string
          enum: 
            - ENTITY_DATASET
            - ENTITY_TRANSFORMER
            - ENTITY_TRANSFORMER_RUN
            - ENTITY_CONSUMER
            - ENTITY_INPUT
            - ENTITY_QUALITY_TEST
            - ENTITY_QUALITY_TEST_RUN
        path:
          type: string
          example: "/datasets"
      required:
        - name
        - path
